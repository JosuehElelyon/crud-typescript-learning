import { Request, Response } from 'express';\nimport UserRepository from '../repositories/UserRepository';\nimport { createUserSchema, updateUserSchema } from '../validators/userValidator';\nimport { ZodError } from 'zod';\n\nclass UserController {\n  // GET /users - Lista todos os usuários\n  async index(req: Request, res: Response): Promise<Response> {\n    try {\n      const users = await UserRepository.findAll();\n      return res.json(users);\n    } catch (error) {\n      console.error(error);\n      return res.status(500).json({ error: 'Erro ao buscar usuários' });\n    }\n  }\n\n  // GET /users/:id - Busca um usuário por ID\n  async show(req: Request, res: Response): Promise<Response> {\n    try {\n      const { id } = req.params;\n      const user = await UserRepository.findById(Number(id));\n\n      if (!user) {\n        return res.status(404).json({ error: 'Usuário não encontrado' });\n      }\n\n      return res.json(user);\n    } catch (error) {\n      console.error(error);\n      return res.status(500).json({ error: 'Erro ao buscar usuário' });\n    }\n  }\n\n  // POST /users - Cria um novo usuário\n  async store(req: Request, res: Response): Promise<Response> {\n    try {\n      // Validação com Zod\n      const validatedData = createUserSchema.parse(req.body);\n\n      // Verificar se email já existe\n      const existingUser = await UserRepository.findByEmail(validatedData.email);\n      if (existingUser) {\n        return res.status(400).json({ error: 'Email já cadastrado' });\n      }\n\n      const newUser = await UserRepository.create(validatedData);\n      return res.status(201).json(newUser);\n    } catch (error) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({  \n          error: 'Dados inválidos',  \n          details: error.errors.map(e => ({\n            field: e.path.join('.'),\n            message: e.message\n          }))\n        });\n      }\n      console.error(error);\n      return res.status(500).json({ error: 'Erro ao criar usuário' });\n    }\n  }\n\n  // PUT /users/:id - Atualiza um usuário\n  async update(req: Request, res: Response): Promise<Response> {\n    try {\n      const { id } = req.params;\n      \n      // Validação com Zod\n      const validatedData = updateUserSchema.parse(req.body);\n\n      // Se está atualizando email, verificar se já existe\n      if (validatedData.email) {\n        const existingUser = await UserRepository.findByEmail(validatedData.email);\n        if (existingUser && existingUser.id !== Number(id)) {\n          return res.status(400).json({ error: 'Email já cadastrado' });\n        }\n      }\n\n      const updatedUser = await UserRepository.update(Number(id), validatedData);\n\n      if (!updatedUser) {\n        return res.status(404).json({ error: 'Usuário não encontrado' });\n      }\n\n      return res.json(updatedUser);\n    } catch (error) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({  \n          error: 'Dados inválidos',  \n          details: error.errors.map(e => ({\n            field: e.path.join('.'),\n            message: e.message\n          }))\n        });\n      }\n      console.error(error);\n      return res.status(500).json({ error: 'Erro ao atualizar usuário' });\n    }\n  }\n\n  // DELETE /users/:id - Deleta um usuário\n  async destroy(req: Request, res: Response): Promise<Response> {\n    try {\n      const { id } = req.params;\n      const deleted = await UserRepository.delete(Number(id));\n\n      if (!deleted) {\n        return res.status(404).json({ error: 'Usuário não encontrado' });\n      }\n\n      return res.status(204).send();\n    } catch (error) {\n      console.error(error);\n      return res.status(500).json({ error: 'Erro ao deletar usuário' });\n    }\n  }\n}\n\nexport default new UserController();\n